{% extends "layout.html" %}

{% block head %}
<script>
window.onload = function () {
    let input = document.querySelector('select');
    input.addEventListener('change', async function(e) {
        let response = await fetch('/vehicles', {
            method: 'POST',
            body: 'vehicle=' + encodeURIComponent(e.target.value),
            headers: {
                'Content-type': 'application/x-www-form-urlencoded'
            },
            credentials: 'include',
        });
        let vehicles = await response.json();
        let html = '';
        for (let v in vehicles) {
            html += '<tr><td>' + vehicles[v][3] + '</td><td>' + vehicles[v][2] + '</td><td>' + vehicles[v][1] + '</td><td>' + vehicles[v][0] + '</td></tr>';
        }
        document.getElementById('toChange').innerHTML = html;
    });
}
</script>
{% endblock %}

{% block title %}
    List of the vehicles in your fleet
{% endblock %}

{% block main %}

    <div style="text-align:center; max-width:1100px; margin: auto;">
    {% if not vehicle %}
        <h2>Vehicles</h2>
        <table class="table table-hover table-sm">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Mileage of the next oil change</th>
                    <th>Latest Inspection Mileage</th>
                    <th>Latest Inspection Date</th>
                    <th>Projected date of next oil change</th>
                </tr>
            </thead>
            {% for v, i in vehicles.items() %}
            <tbody>
                <tr style='cursor: pointer; cursor: hand;' onclick="window.location='/vehicles?vehicle={{ v }}';">
                    <td>{{ v }}</td>
                    <td>{{ i[0][0] }}</td>
                    <td>{{ i[0][1] }}</td>
                    <td>{{ i[0][2] }}</td>
                    <td>{{ i[0][3] }}</td>
                </tr>
            </tbody>
            {% endfor %}
        </table>
    </div>
{% else %}
    <h4>View another</h4>
    <form>
        <div class="mb-3"></div>
            <select class="form-select" name="vehicle" style="width: auto; margin-right:auto; margin-left:auto; margin-bottom:1em">
                {% for v in vehicles %}
                    {% if vehicle == v["number"] %}
                        <option selected value="{{ v["number"] }}">Vehicle {{ v["number"] }}</option>
                    {% else %}
                        <option value="{{ v["number"] }}">Vehicle {{ v["number"] }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>
    </form>
    <div style="text-align:center; max-width:1100px; margin: auto;">
    <h2>Vehicle {{vehicle}}: Latest problems</h2>
        <table class="table table-hover table-sm">
            <thead>
                <tr>
                    <th>By</th>
                    <th>Date</th>
                    <th>Item</th>
                    <th>Notes</th>
                </tr>
            </thead>
            <tbody id="toChange">
            {% for i in inspection %}
                <tr>
                    <td>{{ i[3] }}</td>
                    <td>{{ i[2] }}</td>
                    <td>{{ i[1] }}</td>
                    <td>{{ i[0] }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% endif %}
{% endblock %}